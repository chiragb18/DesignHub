<nav class="toolbar-container" [class.is-mobile]="bannerService.isMobile()">
    <!-- Left Section: Logo & Branding -->
    <div class="toolbar-left">
        <div class="brand-logo">
            <div class="logo-wrapper">
                <img src="designHub-logo.png" alt="DesignHub Logo" class="main-logo-img">
                <div class="logo-glow"></div>
            </div>
            <div class="brand-name" *ngIf="!bannerService.isMobile()">Design<span>Hub</span></div>
        </div>
    </div>

    <!-- Center Section: Main Tools -->
    <div class="toolbar-center">
        <div class="tools-scroll-container">

            <!-- Crop Mode Active -->
            <ng-container *ngIf="isCropping">
                <div class="context-label" *ngIf="!bannerService.isMobile()">Crop Image</div>
                <button (click)="cancelCrop()" class="nav-tool-btn cancel-btn" title="Cancel Crop">
                    <span class="material-symbols-outlined">close</span>
                    <span class="tool-label">Cancel</span>
                </button>
                <button (click)="applyCrop()" class="nav-tool-btn apply-btn" title="Apply Crop">
                    <span class="material-symbols-outlined">check</span>
                    <span class="tool-label">Apply</span>
                </button>
            </ng-container>

            <!-- Standard Tools -->
            <ng-container *ngIf="!isCropping">

                <!-- Select -->
                <button (click)="setSelectMode()" class="nav-tool-btn"
                    [class.active]="!bannerService.isDrawingMode() && !bannerService.isErasing()"
                    title="Select Tool (V)">
                    <span class="material-symbols-outlined">near_me</span>
                    <span class="tool-label">Select</span>
                </button>

                <!-- Crop (only when image selected) -->
                <button *ngIf="selectedObject?.type === 'image'" (click)="startCrop()" class="nav-tool-btn"
                    title="Crop Image">
                    <span class="material-symbols-outlined">crop</span>
                    <span class="tool-label">Crop</span>
                </button>

                <div class="divider"></div>

                <!-- ══════════════════════════════════════════════════════════ -->
                <!-- BRUSH — opens the Draw sidebar panel                      -->
                <!-- ══════════════════════════════════════════════════════════ -->
                <button (click)="openDrawSidebar()" class="nav-tool-btn" [class.active]="bannerService.isDrawingMode()"
                    title="Brush Tool — opens Draw panel">
                    <span class="material-symbols-outlined">brush</span>
                    <span class="tool-label">Brush</span>
                </button>

                <!-- ERASER -->
                <button (click)="openEraserMode()" class="nav-tool-btn" [class.active]="bannerService.isErasing()"
                    title="Eraser Tool (E)">
                    <span class="material-symbols-outlined">ink_eraser</span>
                    <span class="tool-label">Eraser</span>
                </button>


                <div class="divider"></div>

                <!-- Text -->
                <button (click)="addText()" class="nav-tool-btn" title="Add Text (T)">
                    <span class="material-symbols-outlined">title</span>
                    <span class="tool-label">Text</span>
                </button>

                <!-- Upload -->
                <button (click)="triggerUpload()" class="nav-tool-btn" title="Upload Image (U)">
                    <span class="material-symbols-outlined">image</span>
                    <span class="tool-label">Upload</span>
                </button>

            </ng-container>
        </div>
    </div>

    <!-- Right Section: Actions -->
    <div class="toolbar-right" *ngIf="!isCropping">

        <!-- Desktop Actions -->
        <ng-container *ngIf="!bannerService.isMobile()">
            <button (click)="undo()" class="nav-tool-btn" title="Undo (Ctrl+Z)" [disabled]="!bannerService.canUndo()">
                <span class="material-symbols-outlined">undo</span>
            </button>
            <button (click)="redo()" class="nav-tool-btn" title="Redo (Ctrl+Y)" [disabled]="!bannerService.canRedo()">
                <span class="material-symbols-outlined">redo</span>
            </button>

            <div class="divider"></div>

            <!-- Language Toggle -->
            <div class="language-toggle">
                <button class="lang-btn" [class.active]="currentLanguage === 'en'" (click)="toggleLanguage('en')">
                    EN
                </button>
                <button class="lang-btn" [class.active]="currentLanguage === 'mr'" (click)="toggleLanguage('mr')">
                    मराठी
                </button>
            </div>

            <div class="divider"></div>

            <button (click)="startNewDesign()" class="btn-outline">New Design</button>

            <div class="dropdown-wrapper">
                <button (click)="toggleMenu('save')" class="btn-primary-outline" [class.active]="activeMenu === 'save'">
                    <span class="material-symbols-outlined">save</span>
                    Save
                    <span class="material-symbols-outlined arrow">expand_more</span>
                </button>
                <div class="dropdown-menu right-align" *ngIf="activeMenu === 'save'">
                    <button (click)="saveProject()" class="menu-item">
                        <span class="material-symbols-outlined">save_as</span> Save Project
                    </button>
                    <div class="menu-divider"></div>
                    <button (click)="saveAsTemplate()" class="menu-item">
                        <span class="material-symbols-outlined">grid_view</span> Save as Template
                    </button>
                    <button (click)="saveAsDesign()" class="menu-item">
                        <span class="material-symbols-outlined">design_services</span> Save as Design
                    </button>
                    <button (click)="saveAsBackground()" class="menu-item">
                        <span class="material-symbols-outlined">wallpaper</span> Save as Background
                    </button>
                    <div class="menu-divider"></div>
                    <button (click)="exportLibrary()" class="menu-item deploy-item"
                        title="Export all saved items to a JSON file for Vercel deployment">
                        <span class="material-symbols-outlined">cloud_upload</span>
                        <span>
                            Export Library for Deploy
                            <small style="display:block;font-size:10px;color:#64748b;margin-top:1px">Bundles templates
                                for Vercel</small>
                        </span>
                    </button>
                </div>
            </div>

            <button (click)="downloadPNG()" class="btn-primary">
                <span class="material-symbols-outlined">download</span>
                Download
            </button>
        </ng-container>

        <!-- Mobile More Menu -->
        <ng-container *ngIf="bannerService.isMobile()">
            <button (click)="undo()" class="nav-tool-btn icon-only" [disabled]="!bannerService.canUndo()">
                <span class="material-symbols-outlined">undo</span>
            </button>
            <button (click)="redo()" class="nav-tool-btn icon-only" [disabled]="!bannerService.canRedo()">
                <span class="material-symbols-outlined">redo</span>
            </button>

            <div class="dropdown-wrapper">
                <button (click)="toggleMenu('more')" class="nav-tool-btn icon-only"
                    [class.active]="activeMenu === 'more'">
                    <span class="material-symbols-outlined">more_vert</span>
                </button>
                <div class="dropdown-menu right-align" *ngIf="activeMenu === 'more'">
                    <button (click)="downloadPNG()" class="menu-item highlight">
                        <span class="material-symbols-outlined">download</span> Download PNG
                    </button>
                    <div class="menu-divider"></div>
                    <button (click)="saveProject()" class="menu-item">
                        <span class="material-symbols-outlined">save</span> Save Project
                    </button>
                    <button (click)="saveAsTemplate()" class="menu-item">
                        <span class="material-symbols-outlined">grid_view</span> Save as Template
                    </button>
                    <button (click)="saveAsDesign()" class="menu-item">
                        <span class="material-symbols-outlined">design_services</span> Save as Design
                    </button>
                    <button (click)="saveAsBackground()" class="menu-item">
                        <span class="material-symbols-outlined">wallpaper</span> Save as Background
                    </button>
                    <button (click)="startNewDesign()" class="menu-item">
                        <span class="material-symbols-outlined">add_circle</span> New Design
                    </button>
                    <div class="menu-divider"></div>
                    <button (click)="exportLibrary()" class="menu-item deploy-item">
                        <span class="material-symbols-outlined">cloud_upload</span> Export Library for Deploy
                    </button>
                    <div class="menu-divider"></div>
                    <div class="lang-selector-item">
                        <span class="material-symbols-outlined">language</span>
                        <div class="lang-chips">
                            <span [class.active]="currentLanguage === 'en'" (click)="toggleLanguage('en')">EN</span>
                            <span [class.active]="currentLanguage === 'mr'" (click)="toggleLanguage('mr')">MR</span>
                        </div>
                    </div>
                </div>
            </div>
        </ng-container>
    </div>

    <input type="file" id="imageUpload" style="display: none;" (change)="uploadImage($event)" accept="image/*">
</nav>